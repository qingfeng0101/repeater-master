import{f as H,h as J,o as c,l as y,j as r,c as N,r as j,F as T,u as l,ak as W,an as Y,i as u,aA as Z,n as F,D as ee,aB as ae,t as te,ah as le,H as d,ad as q,aC as se,A as ue,ap as P,aw as $,ar as re,aj as oe,af as G,ae as v,aD as z,aE as I,e as ne,ai as ie,G as D,aF as de}from "./315a852e.js";import{e as fe,d as ce,f as me,g as pe}from "./b4128dcd.js";import{p as ve,e as _e,f as be,g as he}from "./3a8f2c57.js";import{a as ye,s as ge}from "./ad89c71c.js";import{c as ke}from "./2d7efc63.js";import{b as Ee,M}from "./index.148f4d09.js";const xe=H({__name:"DynamicChecbox",props:{model:null,modelValue:null},emits:["update:modelValue"],setup(_, {emit:f}){const p=_,b=J({get(){return p.modelValue},set(s){f("update:modelValue",s)}});return(s, C)=>(c(),y(l(W),null,{default:r(()=>[(c(!0),N(T,null,j(_.model,(h, n, g)=>(c(),N("div",{key:n,class:Y({flex:!0,"mb-8px":g!==Object.keys(_.model).length-1})},[u(l(Z),{class:"w-64px"},{default:r(()=>[F(ee(n)+":",1)]),_:2},1024),u(l(ae),{value:l(b)[n],"onUpdate:value": i=>l(b)[n]=i},{default:r(()=>[u(l(te),{"item-style":"display: flex"},{default:r(()=>[(c(!0),N(T,null,j(h, i=>(c(),y(l(le),{value:i,label:i,key:i},null,8,["value","label"]))),128))]),_:2},1024)]),_:2},1032,["value","onUpdate:value"])],2))),128))]),_:1}))}}),Ce={class:"flex justify-end"},Be=H({__name:"Action",props:{id:{type:Number,required:!1}},setup(_){const f=_,p=Ee(),b=d(null),s=q({name:"",label_set_list:[],contact_ids:[],sender_filter:{},sender_set_id:void 0,comment:""});let C=[];const h=d(!1);f.id&&(h.value=!0,fe(f.id).then(a=>{const e=a.data;s.name=e.name,C=e.label_set_list,s.sender_filter=e.sender_filter;for(let t of Object.keys(e.sender_filter))p.sender_filter[t]=e.sender_filter[t];s.sender_set_id=e.sender_set_id;for(let t of e.contacts)s.contact_ids.push(t.id);h.value=!1}));const n=d(""),g={name:{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:"blur"},contact_ids:{type:"array",required:!0,message:"\u8BF7\u9009\u62E9\u901A\u77E5\u76EE\u6807",trigger:["blur","change"]},sender_set_id:{type:"number",required:!0,trigger:["blur","change"],message:"\u8BF7\u9009\u62E9\u901A\u77E5\u5206\u53D1\u96C6\u5408"}},i=d([]),S=d(),w=d(),A=d();let B={};ce().then(a=>{B=a.data}),ve().then(a=>{for(let e of a.data)n.value||(n.value=e.name),i.value.push({label:e.name,value:e.name})}),_e().then(a=>{for(let e of a.data)n.value||(n.value=e.name),i.value.push({label:e.name,value:e.name})}),ke().then(a=>{w.value=a.data.map(e=>({label:e.name,value:e.id}))}),ye().then(a=>{A.value=a.data.map(e=>({label:e.name,value:e.id}))});const L=q(new Set);ge().then(a=>{for(let e of a.data)L.add(e.type)});const R=d([]),k=d(!1);se(n, a=>{k.value=!0,g.label_set_list=[],be({source:a}).then(e=>{S.value=e.data.map(t=>({label:t.service_name||t.namespace||t.instance,value:t,disabled:X(t,B,C)})),k.value=!1}),he({source:a}).then(e=>{R.value=e.data.severity_set})});const V=J(()=>{let a={};for(let e of R.value)a[e]=Array.from(L);return a}),O=({option:a})=>D($,{delay:1500,trigger:"hover"},{trigger:()=>D("div",D(de,{tooltip:!1},{default:()=>a.label})),default:()=>JSON.stringify(a.value)}),K=ue();function Q(){var a;(a=b.value)==null||a.validate(e=>{var t;if(console.log(s),e)console.log("errors"),(t=M)==null||t.error("\u9A8C\u8BC1\u5931\u8D25");else{let E={};for(let o of Object.keys(V.value))E[o]=p.sender_filter[o];s.sender_filter=E,(f.id?me(f.id,s):pe(s)).then(o=>{var m;(m=M)==null||m.success("success"),K.push({name:"PrometheusNotifyRule"})})}})}function X(a, e, t){let E=(o, m)=>{for(let U in o)if(o[U]!==m[U])return!1;return!0};for(let o of t)if(E(a,o))return!1;let x=[];for(let o in a)x.push(`${o}=${a[o]}`);for(let o=0; o<x.length&&Object.keys(e).indexOf("children")!==-1; o++)for(let m of e.children)if(x[o]==m.key){e=m,o=-1;break}return!!e.value}return(a, e)=>(c(),y(l(W),{title:`${f.id?"\u7F16\u8F91":"\u6DFB\u52A0"}\u901A\u77E5\u89C4\u5219`,segmented:""},{"header-extra":r(()=>[u(l($),{trigger:"hover"},{trigger:r(()=>[u(l(P),{value:n.value,"onUpdate:value":e[0]||(e[0]= t=>n.value=t),options:i.value},null,8,["value","options"])]),default:r(()=>[F(" \u9009\u62E9\u6570\u636E\u6E90 ")]),_:1})]),default:r(()=>[h.value?(c(),y(l(re),{key:0,text:"",repeat:12})):(c(),y(l(oe),{key:1,ref_key:"formRef",ref:b,model:s,"label-placement":"left","label-width":160,rules:g,style:{maxWidth:"800px"}},{default:r(()=>[u(l(v),{label:"\u540D\u79F0:",path:"name"},{default:r(()=>[u(l(G),{value:s.name,"onUpdate:value":e[1]||(e[1]= t=>s.name=t),disabled:!!f.id},null,8,["value","disabled"])]),_:1}),u(l(v),{label:"\u89C4\u5219\u5339\u914D\u6807\u7B7E:",path:"label_set_list"},{default:r(()=>[u(l(z),{show:k.value,class:"wfull"},{default:r(()=>[u(l(I),{value:s.label_set_list,"onUpdate:value":e[2]||(e[2]= t=>s.label_set_list=t),"virtual-scroll":"",options:S.value,"source-filterable":"","render-source-label":O,"render-target-label":O},null,8,["value","options"])]),_:1},8,["show"])]),_:1}),u(l(v),{label:"\u901A\u77E5\u76EE\u6807:",path:"contact_ids"},{default:r(()=>[u(l(I),{value:s.contact_ids,"onUpdate:value":e[3]||(e[3]= t=>s.contact_ids=t),"virtual-scroll":"","source-filterable":"",options:w.value},null,8,["value","options"])]),_:1}),u(l(v),{label:"\u901A\u77E5\u53D1\u9001\u5668\u96C6\u5408:",path:"sender_set_id"},{default:r(()=>[u(l(P),{value:s.sender_set_id,"onUpdate:value":e[4]||(e[4]= t=>s.sender_set_id=t),options:A.value},null,8,["value","options"])]),_:1}),u(l(v),{label:"\u4E25\u91CD\u7A0B\u5EA6\u53D1\u9001\u89C4\u5219:"},{default:r(()=>[u(l(z),{show:k.value,class:"wfull"},{default:r(()=>[u(xe,{modelValue:l(p).sender_filter,"onUpdate:modelValue":e[5]||(e[5]= t=>l(p).sender_filter=t),model:l(V)},null,8,["modelValue","model"])]),_:1},8,["show"])]),_:1}),u(l(v),{label:"\u5907\u6CE8: ",path:"comment"},{default:r(()=>[u(l(G),{value:s.comment,"onUpdate:value":e[6]||(e[6]= t=>s.comment=t),type:"textarea",autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1}),ne("div",Ce,[u(l(ie),{onClick:Q,type:"primary"},{default:r(()=>[F("\u63D0\u4EA4")]),_:1})])]),_:1},8,["model"]))]),_:1},8,["title"]))}});export{Be as default};
